name: CI of docker
on:
  push:
    branches: [ main ]     
  workflow_dispatch:
   
jobs: 
  build:  
    runs-on: ubuntu-latest  
    steps:
         
      - name: Login to Yandex.Cloud Container Registry
        uses: docker/login-action@v1
        with:
          registry: cr.yandex/${{ secrets.REGISTRY_NAME }}
          username: ${{ secrets.YANDEX_USER }}
          password: ${{ secrets.YANDEX_PASS }}
        
      
      - name: Git clone my repo
        uses: actions/checkout@v2   

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1             
       
          
      - name: Build and push
        env:
          DOCKER_IMG: cat-gpt-2
          
        run: |
          docker build -t $DOCKER_IMG ./catgpt
          # docker tag ${{ secrets.DOCKER_IMG }}  cr.yandex/${{ secrets.REGISTRY_NAME }}/$DOCKER_IMG
          docker push cr.yandex/${{ secrets.REGISTRY_NAME }}/${{ secrets.DOCKER_IMG }}
          
          
          
